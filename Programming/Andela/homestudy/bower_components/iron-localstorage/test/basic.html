<!DOCTYPE html><html><head><meta charset="UTF-8"><title>iron-localstorage-basic</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="../../webcomponentsjs/webcomponents-lite.js"></script><script src="../../web-component-tester/browser.js"></script><link rel="import" href="../iron-localstorage.html"></head><body><test-fixture id="fixture"><template><iron-localstorage id="localstorage" name="iron-localstorage-test"></iron-localstorage></template></test-fixture><test-fixture id="nameless"><template><iron-localstorage id="localstorage"></iron-localstorage></template></test-fixture><dom-bind><template id="boundTemplate" is="dom-bind"><iron-localstorage id="boundLocal" name="iron-localstorage-test" value="{{value}}"></iron-localstorage></template></dom-bind><script>var storage,nameless;suite("basic",function(){setup(function(){window.localStorage.setItem("iron-localstorage-test","{\"foo\":\"bar\"}");storage=document.getElementById("fixture").create();nameless=document.getElementById("nameless").create();document.getElementById("nameless").restore();storage.flushDebouncer("reload")});teardown(function(){window.localStorage.removeItem("iron-localstorage-test")});test("load",function(){assert.isNotNull(storage.value);assert.equal(storage.value.foo,"bar")});test("save",function(){var newValue={foo:"zot"};storage.value=newValue;storage.flushDebouncer("save");var v=window.localStorage.getItem(storage.name);v=JSON.parse(v);assert.equal(v.foo,newValue.foo)});test("delete",function(){storage.value=null;storage.flushDebouncer("save");var v=window.localStorage.getItem(storage.name);assert.isNull(v);storage.value=void 0;storage.flushDebouncer("save");var v=window.localStorage.getItem(storage.name);assert.isNull(v)});test("event iron-localstorage-load",function(done){nameless.addEventListener("iron-localstorage-load",function(){done()});nameless.name="iron-localstorage-test"});test("event iron-localstorage-load-empty",function(done){window.localStorage.removeItem("iron-localstorage-test");nameless.addEventListener("iron-localstorage-load-empty",function(){nameless.value="Yo";nameless.flushDebouncer("save");assert.equal("Yo",JSON.parse(window.localStorage.getItem("iron-localstorage-test")));done()});nameless.name="iron-localstorage-test"});test("auto-save sub-properties",function(){var t=document.querySelector("#boundTemplate"),ls=document.querySelector("#boundLocal"),value={foo:"FOO",bar:"BAR"};if(Polymer.Element){t.value=value;t=t.parentNode}t.value=value;assert.equal("FOO",ls.value.foo);ls.flushDebouncer("save");t.value.foo="Yo";ls.flushDebouncer("save");var item=JSON.parse(window.localStorage.getItem("iron-localstorage-test"));assert.notEqual("Yo",item.foo);t.set("value.foo","BAZ!");ls.flushDebouncer("save");var item=JSON.parse(window.localStorage.getItem("iron-localstorage-test"));assert.equal("BAZ!",item.foo);ls.value=null})});</script></body></html>