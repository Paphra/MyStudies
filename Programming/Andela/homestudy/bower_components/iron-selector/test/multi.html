<!DOCTYPE html><html><head><title>iron-selector-multi</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="../../webcomponentsjs/webcomponents-lite.js"></script><script src="../../web-component-tester/browser.js"></script><script src="../../test-fixture/test-fixture-mocha.js"></script><link rel="import" href="../../test-fixture/test-fixture.html"><link rel="import" href="../../iron-test-helpers/iron-test-helpers.html"><link rel="import" href="../iron-selector.html"><style>.iron-selected{background:#ccc;}</style></head><body><test-fixture id="test"><template><iron-selector multi=""><div>Item 0</div><div>Item 1</div><div>Item 2</div><div>Item 3</div><div>Item 4</div></iron-selector></template></test-fixture><test-fixture id="valueById"><template><iron-selector multi="" attr-for-selected="id"><div id="item0">Item 0</div><div id="item1">Item 1</div><div id="item2">Item 2</div><div id="item3">Item 3</div><div id="item4">Item 4</div></iron-selector></template></test-fixture><test-fixture id="repeatedItems-polymer1"><template><iron-selector multi=""><template is="dom-repeat" items="[&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]"><div>[[item]]</div></template><div>vim</div></iron-selector></template></test-fixture><test-fixture id="repeatedItems-polymer2"><template><iron-selector multi=""><dom-repeat items="[&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]"><template><div>[[item]]</div></template></dom-repeat><div>vim</div></iron-selector></template></test-fixture><script>suite("multi",function(){var s;setup(function(done){s=fixture("test");s.addEventListener("iron-items-changed",function onIronItemsChanged(){s.removeEventListener("iron-items-changed",onIronItemsChanged);done()})});test("honors the multi attribute",function(){assert.isTrue(s.multi)});test("has sane defaults",function(){assert.deepEqual(s.selectedValues,[]);assert.equal(s.selectedClass,"iron-selected");assert.equal(s.items.length,5)});test("set multi-selection via selected property",function(){s.selectedValues=[0,2];assert.isTrue(s.children[0].classList.contains("iron-selected"));assert.isTrue(s.children[2].classList.contains("iron-selected"));assert.equal(s.selectedItems.length,2);assert.equal(s.selectedItems[0],s.children[0]);assert.equal(s.selectedItems[1],s.children[2])});test("set multi-selection via tap",function(){MockInteractions.tap(s.children[0]);MockInteractions.tap(s.children[2]);assert.isTrue(s.children[0].classList.contains("iron-selected"));assert.isTrue(s.children[2].classList.contains("iron-selected"));assert.equal(s.selectedItems.length,2);assert.equal(s.selectedItems[0],s.children[0]);assert.equal(s.selectedItems[1],s.children[2])});test("fire iron-select/deselect events when selectedValues changes",function(){var items=[s.children[0],s.children[1],s.children[2]],selectEventCounters=[0,0,0],deselectEventCounters=[0,0,0];s.addEventListener("iron-select",function(e){selectEventCounters[items.indexOf(e.detail.item)]++});s.addEventListener("iron-deselect",function(e){deselectEventCounters[items.indexOf(e.detail.item)]++});s.selectedValues=[0,1];s.selectedValues=[1,2];s.selectedValues=[];assert.equal(selectEventCounters[0],1);assert.equal(deselectEventCounters[0],1);assert.equal(selectEventCounters[1],1);assert.equal(deselectEventCounters[1],1);assert.equal(selectEventCounters[2],1);assert.equal(deselectEventCounters[2],1)});test("fire iron-select/deselect events when selectedValues is modified",function(){var items=[s.children[0],s.children[1],s.children[2]],selectEventCounters=[0,0,0],deselectEventCounters=[0,0,0];s.addEventListener("iron-select",function(e){selectEventCounters[items.indexOf(e.detail.item)]++});s.addEventListener("iron-deselect",function(e){deselectEventCounters[items.indexOf(e.detail.item)]++});s.selectedValues=[];s.push("selectedValues",0,1);s.shift("selectedValues");s.push("selectedValues",2);s.shift("selectedValues");assert.equal(selectEventCounters[0],1);assert.equal(deselectEventCounters[0],1);assert.equal(selectEventCounters[1],1);assert.equal(deselectEventCounters[1],1);assert.equal(selectEventCounters[2],1);assert.equal(deselectEventCounters[2],0)});test("fire iron-select/deselect events when toggling items",function(){var items=[s.children[0],s.children[1],s.children[2]],selectEventCounters=[0,0,0],deselectEventCounters=[0,0,0];s.addEventListener("iron-select",function(e){selectEventCounters[items.indexOf(e.detail.item)]++});s.addEventListener("iron-deselect",function(e){deselectEventCounters[items.indexOf(e.detail.item)]++});MockInteractions.tap(items[0]);MockInteractions.tap(items[1]);s.selectedValues=[1,2];MockInteractions.tap(items[1]);MockInteractions.tap(items[2]);assert.equal(selectEventCounters[0],1);assert.equal(deselectEventCounters[0],1);assert.equal(selectEventCounters[1],1);assert.equal(deselectEventCounters[1],1);assert.equal(selectEventCounters[2],1);assert.equal(deselectEventCounters[2],1)});test("toggle iron-selected class when toggling items selection",function(){var item0=s.children[0],item1=s.children[1];assert.isFalse(item0.classList.contains("iron-selected"));assert.isFalse(item1.classList.contains("iron-selected"));MockInteractions.tap(item0);assert.isTrue(item0.classList.contains("iron-selected"));assert.isFalse(item1.classList.contains("iron-selected"));MockInteractions.tap(item1);assert.isTrue(item0.classList.contains("iron-selected"));assert.isTrue(item1.classList.contains("iron-selected"));MockInteractions.tap(item1);assert.isTrue(item0.classList.contains("iron-selected"));assert.isFalse(item1.classList.contains("iron-selected"));s.selectedValues=[0,1];assert.isTrue(item0.classList.contains("iron-selected"));assert.isTrue(item1.classList.contains("iron-selected"));s.selectedValues=[];assert.isFalse(item0.classList.contains("iron-selected"));assert.isFalse(item1.classList.contains("iron-selected"))});test("fires selected-values-changed when selection changes",function(){var selectedValuesChangedEventCounter=0;s.addEventListener("selected-values-changed",function(){selectedValuesChangedEventCounter++});MockInteractions.tap(Polymer.dom(s).children[0]);MockInteractions.tap(Polymer.dom(s).children[0]);MockInteractions.tap(Polymer.dom(s).children[0]);expect(selectedValuesChangedEventCounter)});test("selects from items created by dom-repeat",function(done){var selector,domRepeat;if(Polymer.Element){selector=fixture("repeatedItems-polymer2");selector.forceSynchronousItemUpdate();domRepeat=selector.querySelector("dom-repeat")}else{selector=fixture("repeatedItems-polymer1");domRepeat=selector.querySelector("template[is=dom-repeat]")}domRepeat.render();selector.forceSynchronousItemUpdate();Polymer.Base.async(function(){var firstChild=Polymer.dom(selector).querySelector("div");MockInteractions.tap(firstChild);assert.equal(selector.selectedItems[0].textContent,"foo");done()})});test("updates selection when dom changes",function(){var firstChild=Polymer.dom(s).querySelector(":first-child"),lastChild=Polymer.dom(s).querySelector(":last-child");MockInteractions.tap(firstChild);MockInteractions.tap(lastChild);expect(s.selectedItems.length).to.be.equal(2);Polymer.dom(s).removeChild(lastChild);Polymer.dom.flush();s.forceSynchronousItemUpdate();expect(s.selectedItems.length).to.be.equal(1);expect(s.selectedItems[0]).to.be.equal(firstChild)});suite("`select()` and `selectIndex()`",function(){var selector;setup(function(done){selector=fixture("valueById");selector.addEventListener("iron-items-changed",function onIronItemsChanged(){selector.removeEventListener("iron-items-changed",onIronItemsChanged);done()})});test("`select()` selects an item with the given value",function(){selector.select("item1");assert.equal(selector.selectedValues.length,1);assert.equal(selector.selectedValues.indexOf("item1"),0);selector.select("item3");assert.equal(selector.selectedValues.length,2);assert.isTrue(0<=selector.selectedValues.indexOf("item3"));selector.select("item2");assert.equal(selector.selectedValues.length,3);assert.isTrue(0<=selector.selectedValues.indexOf("item2"))});test("`selectIndex()` selects an item with the given index",function(){selector.selectIndex(1);assert.equal(selector.selectedValues.length,1);assert.isTrue(0<=selector.selectedValues.indexOf("item1"));assert.equal(selector.selectedItems.length,1);assert.isTrue(0<=selector.selectedItems.indexOf(selector.items[1]));selector.selectIndex(3);assert.equal(selector.selectedValues.length,2);assert.isTrue(0<=selector.selectedValues.indexOf("item3"));assert.equal(selector.selectedItems.length,2);assert.isTrue(0<=selector.selectedItems.indexOf(selector.items[3]));selector.selectIndex(0);assert.equal(selector.selectedValues.length,3);assert.isTrue(0<=selector.selectedValues.indexOf("item0"));assert.equal(selector.selectedItems.length,3);assert.isTrue(0<=selector.selectedItems.indexOf(selector.items[0]))})})});</script></body></html>