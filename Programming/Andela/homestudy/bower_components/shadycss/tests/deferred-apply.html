<!DOCTYPE html><html><head><meta charset="utf-8"><script src="./test-flags.js"></script><script src="../node_modules/wct-browser-legacy/browser.js"></script><script src="../node_modules/@webcomponents/webcomponents-platform/webcomponents-platform.js"></script><script src="../node_modules/es6-promise/dist/es6-promise.auto.min.js"></script><script src="../node_modules/@webcomponents/template/template.js"></script><script src="../node_modules/@webcomponents/html-imports/html-imports.min.js"></script><script src="../node_modules/@webcomponents/shadydom/shadydom.min.js"></script><script src="../node_modules/@webcomponents/custom-elements/custom-elements.min.js"></script><script src="../scoping-shim.min.js"></script><script src="../custom-style-interface.min.js"></script><script src="module/generated/custom-style-element.js"></script><script src="module/generated/make-element.js"></script><title>Apply Shim Deferred</title></head><body><custom-style><style>html{--foo:{background-color:rgb(0, 0, 255);};}</style></custom-style><template id="x-foo"><style>:host{display:block;height:100px;width:100px;background-color:rgb(255, 0, 0);@apply --foo;}</style></template><x-foo></x-foo><script id="applyScript" src="../apply-shim.min.js" defer=""></script><script>suite("Deferred Apply Shim",function(){test("Styling works as expected",function(){let resolveFn=null;const promise=new Promise(resolve=>{resolveFn=resolve}).then(()=>{if(window.HTMLTemplateElement.bootstrap){HTMLTemplateElement.bootstrap(document)}window.makeElement("x-foo")}).then(()=>{const el=document.querySelector("x-foo");assert.equal(getComputedStyle(el).getPropertyValue("background-color").trim(),"rgb(0, 0, 255)")});if("complete"===document.readyState){resolveFn()}else{window.addEventListener("load",resolveFn);window.addEventListener("DOMContentLoaded",()=>{window.removeEventListener("load",resolveFn);resolveFn()})}return promise})});</script></body></html>